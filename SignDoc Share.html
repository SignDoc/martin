<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignDoc Share</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            height: 100vh;
            margin: 0;
            padding-top: 50px;
            padding-left: 10%;
            background-color: white;
            transform: scale(1.2);
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
        }

        .title {
            font-size: 54px;
        }
        .title-lightblue {
            color: lightblue;
        }
        .title-darkgray {
            color: darkgray;
        }

        .highlight {
            background-color: lightblue;
        }
        .button-small {
            position: relative;
            left: 65%;
            transform: scale(1.3);
            font-size: 8px;
            padding: 5px 10px;
        }
        .button-large {
            position: relative;
            left: 50%;
            transform: translateX(-50%) scale(1.3);
            font-size: 15px;
            padding: 10px 20px;
            margin: 4;
            display: block;
        }
        .location-button {
            background-color: transparent;
            border: 2px solid lightblue;
            padding: 10px 25px;
            margin: 10px;
            cursor: pointer;
            width: 250px;
            text-align: center;
            display: inline-block;
            margin-left: 20px;
            font-size: 18px;
        }
        .location-button.selected {
            background-color: green;
            color: white;
        }
        .canvas {
            width: 400px;
            height: 150px;
            border: 5px solid lightblue;
            position: relative;
            margin-top: 0px;
        }
        .input-field {
            display: block;
            width: 400px;
            margin-left: 0px;
        }
        .borrowed-material {
            font-size: 90%;
        }
        .borrowed-input {
            width: 98%;
        }
        .gray-box {
            background-color: lightgray;
            padding: 8px;
            border-radius: 3px;
            width: 80%;
            transform: scale(0.9);
            margin-left: -20px;
        }
		.gray-box.borrowed-material {
    background-color: lightgray;
    padding: 8px;
    border-radius: 3px;
    width: 400px; /* –ü—Ä–æ–º–µ–Ω–µ—Ç–∞ —à–∏—Ä–∏–Ω–∞ –∑–∞ –¥–∞ –±–∏–¥–µ –∏—Å—Ç–∞ –∫–∞–∫–æ –ø–æ–ª–∏—ö–∞—Ç–∞ –∑–∞ –ª–æ–∑–∏–Ω–∫–∞, KW, PA */
    transform: scale(0.9);
    margin-left: 0; /* –ü–æ—É—Å–æ–≥–ª–∞—Å–µ–Ω–æ —Å–æ –¥—Ä—É–≥–∏—Ç–µ –ø–æ–ª–∏—ö–∞ */
}

.input-field.borrowed-input {
    width: 100%; /* –ü—Ä–æ–º–µ–Ω–∞ –∑–∞ –¥–∞ –ø–æ–ª–∏—ö–∞—Ç–∞ –≤–Ω–∞—Ç—Ä–µ —Å–µ —Å–æ–≤–ø–∞—ì–∞–∞—Ç —Å–æ –Ω–æ–≤–∞—Ç–∞ —à–∏—Ä–∏–Ω–∞ –Ω–∞ —Å–∏–≤–æ—Ç–æ –ø–æ–ª–µ */
    margin-left: 0; /* –ü–æ—É—Å–æ–≥–ª–∞—Å–µ–Ω–æ —Å–æ –¥—Ä—É–≥–∏—Ç–µ –ø–æ–ª–∏—ö–∞ */
}

        .message {
            color: green;
        }
        .form-row {
            margin-bottom: 15px;
        }
        .small-select {
            font-size: 14px;
            padding: 5px;
            width: 170px;
            text-align: center;
            text-align-last: center;
            color: gray;
            background-color: white;
            border: 1px solid lightblue;
        }
        .name-row {
            display: flex;
            justify-content: space-between;
            width: 395px;
        }
        .name-input {
            width: 190px;
            margin-right: 10px;
        }
        .last-name-input {
            width: 190px;
        }
        #newSignatureButton {
            background-color: white;
            color: gray;
            border: 2px solid lightblue;
            padding: 10px 20px;
            font-size: 7px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
            left: 200px;
        }
        #newSignatureButton:hover {
            background-color: lightblue;
            color: white;
        }
        #partnerText {
            font-size: 20px;
            color: lightgray;
            text-align: center;
            margin-top: 50px;
        }
        .language-fullscreen {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* –û–≤–∞ –æ—Å–∏–≥—É—Ä—É–≤–∞ –¥–µ–∫–∞ –∫–æ–ø—á–∏—ö–∞—Ç–∞ —Å–µ –Ω–∞—Ä–µ–¥–µ–Ω–∏ –Ω–∞ –ª–µ–≤–æ */
    margin-top: 70px;
}

.logout-button {
    font-size: 20px;
    color: red;
    background-color: white;
    border: 2px solid gray;
    padding: 10px 20px;
    cursor: pointer;
    margin-right: 20px; /* –†–∞–∑–¥–µ–ª–µ—Ç–µ –≥–æ Log Out –∫–æ–ø—á–µ—Ç–æ –æ–¥ Full Screen –∫–æ–ø—á–µ—Ç–æ */
}

.logout-button:hover {
    background-color: lightgray;
    color: darkred;
}

.fullscreen-icon {
    margin-left: 20px; /* –û–≤–∞ –æ—Å–∏–≥—É—Ä—É–≤–∞ –¥–µ–∫–∞ Full Screen –∫–æ–ø—á–µ—Ç–æ –µ –º–∞–ª–∫—É –Ω–∞ –¥–µ—Å–Ω–æ –æ–¥ Log Out */
}

        .language-fullscreen select {
            margin-right: 200px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border: 2px solid lightblue;
        }
        #submit-button {
            background-color: white;
            color: lightblue;
            border: 2px solid lightblue;
            padding: 10px 20px;
            font-size: 15px;
            cursor: not-allowed;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
            position: relative;
            left: 200px;
        }
        #submit-button:enabled {
            background-color: gray;
            color: lightblue;
            cursor: pointer;
        }
        #submit-button:enabled:hover {
            background-color: gray;
            color: white;
        }
        .reset-button {
            background: white;
            border: 1px solid gray;
            cursor: pointer;
            font-size: 24px;
            color: gray;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        .signature-container {
            position: relative;
            width: 100%;
            margin-top: 0;
        }
        .large-checkbox {
            width: 30px;
            height: 30px;
        }
        .back-button {
            background-color: white;
            border: 2px solid lightblue;
            color: lightblue;
            padding: 10px 20px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        .back-button:hover {
            background-color: lightblue;
            color: white;
        }
        .logout-button {
            font-size: 20px;
            color: red;
            background-color: white;
            border: 2px solid gray;
            padding: 10px 20px;
            cursor: pointer;
        }
        .logout-button:hover {
            background-color: lightgray;
            color: darkred;
        }
    </style>
</head>
<body>
    <form id="myForm">
        <div class="language-fullscreen">
    <button type="button" id="logoutButton" class="logout-button"> Log Out
	</button>
    <button type="button" id="fullscreenButton" class="fullscreen-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 6h5V4H4v7h2V6zm7 0h5v5h2V4h-7v2zm5 12h-5v2h7v-7h-2v5zm-7 0H6v-5H4v7h7v-2z" fill="currentColor"/>
        </svg>
    </button>
</div>

        <p id="partnerText" style="font-size: 15px; color: lightgray; text-align: center;">–í–∞—à –¥–æ–≤–µ—Ä–ª–∏–≤ –ø–∞—Ä—Ç–Ω–µ—Ä –∑–∞ –µ-–ø–æ—Ç–ø–∏—Å–∏</p>
        <h1 id="title" style="font-size: 54px;">
            <span style="color: lightblue;">SignDoc</span> 
            <span style="color: darkgray;">Share</span> 
            <span style="font-size: 12px;">‚Ñ¢</span>
        </h1>
        <div style="display: flex; justify-content: center; align-items: center;">
            <p id="user" style="font-size: 12px; color: darkgray; margin-left: 0px;"><strong>üë§:¬†¬†</strong></p>
            <div style="position: relative; display: inline-block;">
                <span style="font-size: 12px; color: red; font-weight: bold;">Te</span><span style="font-size: 16px; color: red; font-weight: bold;">x</span><span style="font-size: 12px; color: lightgray; font-weight: bold;">port</span>
                <sup style="position: absolute; right: -10px; top: 0; font-size: 10px;">¬Æ</sup>
            </div>
        </div>
        <br>
        <button type="button" id="newSignatureButton" onclick="resetForm();" class="button-small"><b>–ö—Ä–µ–∏—Ä–∞—ò –Ω–æ–≤ –µ-–ø–æ—Ç–ø–∏—Å</b></button>
        <br><br><br><br>
        <div class="form-row">
            <input type="checkbox" id="ispratnicaCheckbox" class="large-checkbox" onchange="toggleDocumentType()">
            <label for="ispratnicaCheckbox"><b>–ò–°–ü–†–ê–¢–ù–ò–¶–ê</b></label>
            <input type="checkbox" id="priemnicaCheckbox" class="large-checkbox" style="margin-left: 60px;" onchange="toggleDocumentType()">
            <label for="priemnicaCheckbox"><b>–ü–†–ò–ï–ú–ù–ò–¶–ê</b></label>
        </div>
        <div class="form-row">
            <br>
            <b id="selectLocation">–û–¥–±–µ—Ä–µ—Ç–µ –ª–æ–∫–∞—Ü–∏—ò–∞:</b>
            <br>
            <input type="hidden" id="location" required>
            <button type="button" class="location-button" value="Magacin1" onclick="selectLocation(this)">–ú–∞–≥–∞—Ü–∏–Ω1</button>
            <br>
            <button type="button" class="location-button" value="Krojnica" onclick="selectLocation(this)">–ö—Ä–æ—ò–Ω–∏—Ü–∞</button>
            <br>
            <button type="button" class="location-button" value="Pogon" onclick="selectLocation(this)">–ü–æ–≥–æ–Ω</button>
            <br>
            <button type="button" class="location-button" value="Kontrola" onclick="selectLocation(this)">–ö–æ–Ω—Ç—Ä–æ–ª–∞</button>
            <br>
            <button type="button" class="location-button" value="Magacin2" onclick="selectLocation(this)">–ú–∞–≥–∞—Ü–∏–Ω2 –∫—Ä–∞–µ–Ω –≤–ª–µ–∑</button>
        </div>
        <br>
        <div class="name-row">
            <div class="form-row">
                <b id="nameLabel">–ò–º–µ</b> 
                <input type="text" id="firstName" placeholder="–í–Ω–µ—Å–µ—Ç–µ –∏–º–µ" class="input-field name-input" required>
            </div>
            <div class="form-row">
                <b id="lastNameLabel">–ü—Ä–µ–∑–∏–º–µ</b>
                <input type="text" id="lastName" placeholder="–í–Ω–µ—Å–µ—Ç–µ –ø—Ä–µ–∑–∏–º–µ" class="input-field last-name-input" required>
            </div>
        </div>
        <br>
       <div class="form-row">
    <label for="kw"><b id="kwLabel">KW</b></label>
    <input type="number" id="kw" placeholder="–í–Ω–µ—Å–µ—Ç–µ –≥–æ –±—Ä–æ—ò–æ—Ç –Ω–∞ —Ä–∞–±–æ—Ç–Ω–∞ –Ω–µ–¥–µ–ª–∞" required class="input-field" max="53" min="1" maxlength="2" oninput="validateKW(this)">
</div>
        <br>
       <div class="form-row">
    <label for="pa"><b id="paLabel">PA</b></label>
    <input type="number" id="pa" placeholder="–í–Ω–µ—Å–µ—Ç–µ –≥–æ –±—Ä–æ—ò–æ—Ç –Ω–∞ –Ω–∞–ª–æ–≥–æ—Ç" required class="input-field" min="0" oninput="validatePA(this)">
</div>
        <br>
        <div class="form-row">
            <label for="password"><b id="passwordLabel">–õ–æ–∑–∏–Ω–∫–∞</b></label>
            <div style="display: flex; align-items: center;">
                <input type="password" id="password" oninput="checkPassword()" placeholder="–í–Ω–µ—Å–µ—Ç–µ —ò–∞ –í–∞—à–∞—Ç–∞ –ª–æ–∑–∏–Ω–∫–∞" required class="input-field">
            </div>
        </div>
        <br>
        <div class="gray-box borrowed-material">
            <div class="form-row">
                <input type="checkbox" id="borrowedMaterial" class="large-checkbox" onclick="toggleBorrowedFields()">
                <label for="borrowedMaterial"><b id="borrowedMaterialLabel">–ü–æ–∑–∞—ò–º–µ–Ω –º–∞—Ç–µ—Ä–∏—ò–∞–ª</b></label>
                <input type="checkbox" id="remainingMaterial" class="large-checkbox" style="margin-left: 20px;" onclick="toggleBorrowedFields()">
                <label for="remainingMaterial"><b id="remainingMaterialLabel">–í–∏—à–æ–∫ –º–∞—Ç–µ—Ä–∏—ò–∞–ª</b></label>
            </div>
            <div class="gray-box borrowed-material">
                <div class="form-row">
    <label for="borrowedKW"><b id="borrowedKWLabel">–æ–¥ KW</b></label>
    <input type="number" id="borrowedKW" class="input-field borrowed-input toggle-field" placeholder="–í–Ω–µ—Å–µ—Ç–µ –±—Ä–æ—ò –Ω–∞ —Ä–∞–±–æ—Ç–Ω–∞ –Ω–µ–¥–µ–ª–∞ –æ–¥ –∫–æ—ò–∞ –≤—Ä—à–∏—Ç–µ –∑–∞–µ–º" max="53" min="1" maxlength="2" oninput="validateKW(this)" disabled>
</div>
                <div class="form-row">
    <label for="borrowedPA"><b id="borrowedPALabel">–æ–¥ PA</b></label>
    <input type="number" id="borrowedPA" class="input-field borrowed-input toggle-field" placeholder="–í–Ω–µ—Å–µ—Ç–µ –±—Ä–æ—ò –Ω–∞ –Ω–∞–ª–æ–≥ –æ–¥ –∫–æ—ò –≤—Ä—à–∏—Ç–µ –∑–∞–µ–º" min="0" oninput="validatePA(this)" disabled>
</div>

                <div class="form-row">
                    <label for="notes"><b id="notesLabel">–ó–∞–±–µ–ª–µ—à–∫–∏/–ö–æ–º–µ–Ω—Ç–∞—Ä–∏:</b></label>
                    <textarea id="notes" class="input-field borrowed-input toggle-field" rows="7" cols="52" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∑–∞ –ø–æ–∑–∞—ò–º–µ–Ω–∏–æ—Ç –º–∞—Ç–µ—Ä–∏—ò–∞–ª" disabled></textarea>
                </div>
            </div>
        </div>
        <br>
        <div class="form-row">
            <label for="signature"><b id="signatureLabel">–í–Ω–µ—Å–µ—Ç–µ —Å–≤–æ–µ—Ä–∞—á–µ–Ω –ø–æ—Ç–ø–∏—Å:</b></label>
        </div>
        <div class="signature-container">
            <canvas id="canvas" class="canvas"></canvas>
            <input type="hidden" id="signatureData">
            <button type="button" class="reset-button" onclick="resetSignature()">
                <i class="fas fa-eraser"></i>
            </button>
        </div>
        <br>
        <button id="submit-button" type="button" onclick="if(checkFields()) { confirmSave(); }" class="button-large" disabled><b id="saveButton">–ó–∞—á—É–≤–∞—ò –ü–æ—Ç–ø–∏—Å</b></button>
        <br><br>
        <p style="font-size: 12px; text-align: left">
            <b id="info" style="color: lightblue;">info:</b> <i>+389 78 395 246;</i>
            <b id="mail" style="color: lightblue;"> mail:</b>signdoc.share@gmail.com <b id="mail" style="color: lightblue;">      ¬© </b>2024
        </p>
        <div id="messagecanvas" class="message"></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
    </form>
    <script>
        // Fullscreen functionality
         function openFullscreen() {
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
        } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
        } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
        } else {
            alert("Fullscreen mode is not supported on this device.");
        }
    }

    document.getElementById('fullscreenButton').addEventListener('click', openFullscreen);

    // Logout functionality
    document.getElementById('logoutButton').addEventListener('click', function() {
        window.location.href = 'http://192.168.0.102:8082/Home1.html';
    });

        document.getElementById('fullscreenButton').addEventListener('click', openFullscreen);

        // Initialize the canvas for signature
        function initSignatureCanvas() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let lastPos = { x: 0, y: 0 };

    // –ü–æ—Å—Ç–∞–≤–µ—Ç–µ —ò–∞ –±–æ—ò–∞—Ç–∞ –Ω–∞ –ø–æ—Ç–ø–∏—Å–æ—Ç –≤–æ –º–∞—Å—Ç–∏–ª–æ –±–æ—ò–∞ (—Ç–µ–º–Ω–æ —Å–∏–Ω–∞)
    ctx.strokeStyle = '#1E3A8A'; // –ú–∞—Å—Ç–∏–ª–æ –±–æ—ò–∞ (–º–æ–∂–µ—Ç–µ –¥–∞ —ò–∞ –ø—Ä–∏–ª–∞–≥–æ–¥–∏—Ç–µ —Å–ø–æ—Ä–µ–¥ –≤–∞—à–∏—Ç–µ –ø–æ—Ç—Ä–µ–±–∏)

    function getMousePos(e) {
        const rect = canvas.getBoundingClientRect();
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
    }

    function getTouchPos(e) {
        const rect = canvas.getBoundingClientRect();
        return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
    }

    canvas.addEventListener('mousedown', (e) => {
        drawing = true;
        lastPos = getMousePos(e);
        ctx.beginPath();
        ctx.moveTo(lastPos.x, lastPos.y);
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!drawing) return;
        const pos = getMousePos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastPos = pos;
    });

    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);

    canvas.addEventListener('touchstart', (e) => {
        drawing = true;
        lastPos = getTouchPos(e);
        ctx.beginPath();
        ctx.moveTo(lastPos.x, lastPos.y);
    });

    canvas.addEventListener('touchmove', (e) => {
        if (!drawing) return;
        const pos = getTouchPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastPos = pos;
    });

    canvas.addEventListener('touchend', () => drawing = false);
    canvas.addEventListener('touchcancel', () => drawing = false);
}


        // Call the initialization function
        initSignatureCanvas();

        function selectLocation(button) {
            document.querySelectorAll('.location-button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            document.getElementById('location').value = button.value;
        }

function generatePDF(data) {
    const doc = new jsPDF();

    // –î–æ–±–∏—ò –≥–æ —Ç–µ–∫–æ–≤–Ω–∏–æ—Ç –¥–∞—Ç—É–º –∏ –≤—Ä–µ–º–µ
    const now = new Date();
    const date = now.toLocaleDateString(); // –§–æ—Ä–º–∞—Ç–∏—Ä–∞—ö–µ –Ω–∞ –¥–∞—Ç—É–º
    const time = now.toLocaleTimeString(); // –§–æ—Ä–º–∞—Ç–∏—Ä–∞—ö–µ –Ω–∞ –≤—Ä–µ–º–µ

    // –î–æ–¥–∞–¥–∏ –¥–∞—Ç—É–º –∏ –≤—Ä–µ–º–µ –≤–æ PDF-–æ—Ç
    doc.setFontSize(10);
    doc.text(`Datum: ${date}`, 10, 10);
    doc.text(`Vreme: ${time}`, 150, 10); // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞–Ω–æ –¥–µ—Å–Ω–æ

    // –î–æ–¥–∞–¥–∏ –Ω–∞—Å–ª–æ–≤ –≤–æ PDF-–æ—Ç
    doc.setFontSize(20);
    doc.setTextColor(173, 216, 230); // lightblue color
    doc.text('SignDoc', 10, 30);
    doc.setTextColor(169, 169, 169); // darkgray color
    doc.text('Share', 55, 30);
    doc.setFontSize(28);
    doc.text('e-signed', 90, 30);

    // –î–æ–¥–∞–¥–∏ —Ç–∏–ø –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
    doc.setFontSize(16);
    doc.setTextColor(0, 0, 0); // reset color to black
    doc.text(`TIP NA DOKUMENT: ${data.documentType}`, 10, 50);

    // –î–æ–¥–∞–¥–∏ –æ—Å–Ω–æ–≤–µ–Ω —Ç–µ–∫—Å—Ç –≤–æ PDF-–æ—Ç
    doc.setFontSize(14);
    doc.text(`IME: ${data.firstName}`, 10, 60);
    doc.text(`PREZIME: ${data.lastName}`, 10, 70);
    doc.text(`LOKACIJA: ${data.location}`, 10, 80);
    doc.text(`KW: ${data.kw}`, 10, 90);
    doc.text(`PA: ${data.pa}`, 10, 100);

    // –î–æ–¥–∞–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∑–∞ –ø–æ–∑–∞—ò–º–µ–Ω –∏–ª–∏ –≤–∏—à–æ–∫ –º–∞—Ç–µ—Ä–∏—ò–∞–ª –∞–∫–æ –ø–æ—Å—Ç–æ—ò–∞—Ç
    let yPos = 110;
    if (data.borrowedMaterial || data.remainingMaterial) {
        doc.text(`POZAJMEN MATERIJAL: ${data.borrowedMaterial ? 'DA' : 'NE'}`, 10, yPos);
        yPos += 10;
        doc.text(`VISOK MATERIJAL: ${data.remainingMaterial ? 'DA' : 'NE'}`, 10, yPos);
        yPos += 10;

        if (data.borrowedMaterial) {
            doc.text(`od KW: ${data.borrowedKW}`, 10, yPos);
            yPos += 10;
            doc.text(`od PA: ${data.borrowedPA}`, 10, yPos);
            yPos += 10;
            doc.text(`Komentari/Zabeleshki: ${data.notes}`, 10, yPos);
            yPos += 20; // –î–æ–¥–∞—ò –ø–æ–≤–µ—ú–µ –ø—Ä–æ—Å—Ç–æ—Ä –ø—Ä–µ–¥ –ø–æ—Ç–ø–∏—Å–æ—Ç
        }
    }

    // –î–æ–¥–∞–¥–∏ –≥–æ –∏–º–µ—Ç–æ –Ω–∞–¥ –ø–æ—Ç–ø–∏—Å–æ—Ç
    const signatureX = 105; // –¶–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–∞ X –ø–æ–∑–∏—Ü–∏—ò–∞
    const nameY = 240; // Y –ø–æ–∑–∏—Ü–∏—ò–∞ –∑–∞ –∏–º–µ—Ç–æ
    const signatureY = nameY + 10; // Y –ø–æ–∑–∏—Ü–∏—ò–∞ –∑–∞ –ø–æ—Ç–ø–∏—Å–æ—Ç –≤–µ–¥–Ω–∞—à –ø–æ–¥ –∏–º–µ—Ç–æ

    doc.text(`${data.firstName} ${data.lastName}`, signatureX + 30, nameY, { align: 'center' });

    // –î–æ–¥–∞–¥–∏ –≥–æ –ø–æ—Ç–ø–∏—Å–æ—Ç (image) –≤–æ PDF-–æ—Ç
    const canvas = document.getElementById('canvas');
    const signatureImage = canvas.toDataURL('image/png');
    doc.addImage(signatureImage, 'PNG', signatureX, signatureY, 60, 30); 

    // –ì–µ–Ω–µ—Ä–∏—Ä–∞—ò –∏–º–µ –∑–∞ PDF-–æ—Ç –≤—Ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ —É—Å–ª–æ–≤–∏—Ç–µ
    let fileName = `${data.pa}_${data.location}_${data.kw}.pdf`;

    if (data.remainingMaterial) {
        fileName = `+${data.pa}_${data.location}_${data.kw}.pdf`;
    } else if (data.borrowedMaterial) {
        fileName = `-${data.pa}_${data.location}_${data.kw}.pdf`;
    }

    // –°–∏–º–Ω–∏ –≥–æ PDF-–æ—Ç —Å–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–æ—Ç–æ –∏–º–µ
    doc.save(fileName);
}








        function toggleDocumentType() {
            const isIspratnica = document.getElementById('ispratnicaCheckbox').checked;
            const isPriemnica = document.getElementById('priemnicaCheckbox').checked;

            if (isIspratnica || isPriemnica) {
                document.getElementById('submit-button').disabled = false;
            } else {
                document.getElementById('submit-button').disabled = true;
            }
        }

        function toggleBorrowedFields() {
            const borrowedMaterial = document.getElementById('borrowedMaterial').checked;
            const remainingMaterial = document.getElementById('remainingMaterial').checked;
            const fields = document.querySelectorAll('.toggle-field');
            const grayBox = document.querySelector('.gray-box');

            fields.forEach(field => {
                field.disabled = !(borrowedMaterial || remainingMaterial);
            });

            if (borrowedMaterial || remainingMaterial) {
                grayBox.style.backgroundColor = 'lightblue';
            } else {
                grayBox.style.backgroundColor = 'lightgray';
            }
        }

        function checkFields() {
            const pa = document.getElementById('pa').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const kw = document.getElementById('kw').value;
            const location = document.getElementById('location').value;
            const password = document.getElementById('password').value;
            const borrowedMaterial = document.getElementById('borrowedMaterial').checked;
            const borrowedKW = document.getElementById('borrowedKW').value;
            const borrowedPA = document.getElementById('borrowedPA').value;
            const notes = document.getElementById('notes').value;
            const isIspratnica = document.getElementById('ispratnicaCheckbox').checked;
            const isPriemnica = document.getElementById('priemnicaCheckbox').checked;

            if (!isIspratnica && !isPriemnica) {
                alert('–ú–æ—Ä–∞ –¥–∞ –∏–∑–±–µ—Ä–µ—Ç–µ –ò–°–ü–†–ê–¢–ù–ò–¶–ê –∏–ª–∏ –ü–†–ò–ï–ú–ù–ò–¶–ê –∑–∞ –¥–∞ –º–æ–∂–µ –¥–∞ —Å–µ –∑–∞—á—É–≤–∞ –ø–æ—Ç–ø–∏—Å–æ—Ç.');
                return false;
            }

            if (firstName === '' || lastName === '' || kw === '' || pa === '' || location === '' || password === '') {
                alert('–í–µ –º–æ–ª–∏–º–µ –ø–æ–ø–æ–ª–Ω–µ—Ç–µ –≥–∏ —Å–∏—Ç–µ –∑–∞–¥–æ–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–æ–ª–∏—ö–∞ –ø—Ä–µ–¥ –¥–∞ –∑–∞—á—É–≤–∞—Ç–µ –ø–æ—Ç–ø–∏—Å–æ—Ç.');
                return false;
            }

            if (borrowedMaterial && (borrowedKW === '' || borrowedPA === '' || notes === '')) {
                alert('–í–µ –º–æ–ª–∏–º–µ –ø–æ–ø–æ–ª–Ω–µ—Ç–µ –≥–∏ —Å–∏—Ç–µ –∑–∞–¥–æ–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–æ–ª–∏—ö–∞ –∑–∞ –ø–æ–∑–∞—ò–º–µ–Ω –º–∞—Ç–µ—Ä–∏—ò–∞–ª.');
                return false;
            }

            return true;
        }

        function resetForm() {
            document.getElementById("myForm").reset();
            document.querySelectorAll('.location-button').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('location').value = '';
            resetSignature();
            toggleBorrowedFields();
        }

        function resetSignature() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function confirmSave() {
    if (!checkFields()) return;

    const data = {
        id: new Date().getTime(),
        location: document.getElementById('location').value,
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        kw: document.getElementById('kw').value,
        pa: document.getElementById('pa').value,
        notes: document.getElementById('notes').value,
        password: document.getElementById('password').value,
        signature: document.getElementById('signatureData').value,
        borrowedMaterial: document.getElementById('borrowedMaterial').checked,
        borrowedKW: document.getElementById('borrowedKW').value,
        borrowedPA: document.getElementById('borrowedPA').value,
        remainingMaterial: document.getElementById('remainingMaterial').checked,
        documentType: document.getElementById('ispratnicaCheckbox').checked ? 'ISPRATNICA' : 'PRIEMNICA'
    };

    fetch('/save', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert('–ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ —É—Å–ø–µ—à–Ω–æ –∑–∞—á—É–≤–∞–Ω–∏!');
            generatePDF(data); // –ì–µ–Ω–µ—Ä–∏—Ä–∞—ò –∏ —Å–∏–º–Ω–∏ PDF
            resetForm();
        } else {
            alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ.');
    });
}
function validateKW(input) {
    if (input.value.length > 2) {
        input.value = input.value.slice(0, 2); // –û–≥—Ä–∞–Ω–∏—á–µ—Ç–µ –Ω–∞ –¥–≤–µ —Ü–∏—Ñ—Ä–∏
    }
    if (input.value > 53) {
        input.value = 53; // –ü–æ—Å—Ç–∞–≤–µ—Ç–µ –≥–æ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç 53
    }
    if (input.value < 1) {
        input.value = 1; // –ü–æ—Å—Ç–∞–≤–µ—Ç–µ –≥–æ –Ω–∞ –º–∏–Ω–∏–º–∞–ª–Ω–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç 1
    }
}

function validatePA(input) {
    if (input.value < 0) {
        input.value = ''; // –ê–∫–æ –≤—Ä–µ–¥–Ω–æ—Å—Ç–∞ –µ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∞, –∏–∑–±—Ä–∏—à–µ—Ç–µ —ò–∞
    }
}



    </script>
</body>
</html>
